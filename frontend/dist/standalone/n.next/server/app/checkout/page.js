(()=>{var e={};e.id=285,e.ids=[285],e.modules={2934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},4580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},5869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},7790:e=>{"use strict";e.exports=require("assert")},4770:e=>{"use strict";e.exports=require("crypto")},7702:e=>{"use strict";e.exports=require("events")},2048:e=>{"use strict";e.exports=require("fs")},2615:e=>{"use strict";e.exports=require("http")},2694:e=>{"use strict";e.exports=require("http2")},8791:e=>{"use strict";e.exports=require("https")},9801:e=>{"use strict";e.exports=require("os")},5315:e=>{"use strict";e.exports=require("path")},6162:e=>{"use strict";e.exports=require("stream")},4175:e=>{"use strict";e.exports=require("tty")},7360:e=>{"use strict";e.exports=require("url")},1764:e=>{"use strict";e.exports=require("util")},1568:e=>{"use strict";e.exports=require("zlib")},1274:(e,s,t)=>{"use strict";t.r(s),t.d(s,{GlobalError:()=>i.a,__next_app__:()=>m,originalPathname:()=>x,pages:()=>o,routeModule:()=>u,tree:()=>d}),t(1324),t(3324),t(5866);var r=t(3191),a=t(8716),l=t(7922),i=t.n(l),c=t(5231),n={};for(let e in c)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(n[e]=()=>c[e]);t.d(s,n);let d=["",{children:["checkout",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(t.bind(t,1324)),"/home/ubuntu/ecommerce/frontend/src/app/checkout/page.tsx"]}]},{}]},{layout:[()=>Promise.resolve().then(t.bind(t,3324)),"/home/ubuntu/ecommerce/frontend/src/app/layout.tsx"],"not-found":[()=>Promise.resolve().then(t.t.bind(t,5866,23)),"next/dist/client/components/not-found-error"]}],o=["/home/ubuntu/ecommerce/frontend/src/app/checkout/page.tsx"],x="/checkout/page",m={require:t,loadChunk:()=>Promise.resolve()},u=new r.AppPageRouteModule({definition:{kind:a.x.APP_PAGE,page:"/checkout/page",pathname:"/checkout",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:d}})},2343:(e,s,t)=>{Promise.resolve().then(t.bind(t,5992))},4659:(e,s,t)=>{"use strict";t.d(s,{Z:()=>r});let r=(0,t(6557).Z)("CheckCircle",[["path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14",key:"g774vq"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]])},8916:(e,s,t)=>{"use strict";t.d(s,{Z:()=>r});let r=(0,t(6557).Z)("CreditCard",[["rect",{width:"20",height:"14",x:"2",y:"5",rx:"2",key:"ynyp8z"}],["line",{x1:"2",x2:"22",y1:"10",y2:"10",key:"1b3vmo"}]])},3855:(e,s,t)=>{"use strict";t.d(s,{Z:()=>r});let r=(0,t(6557).Z)("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]])},5992:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>y});var r=t(326),a=t(7577),l=t(5047),i=t(8705);let c=(0,t(6557).Z)("MapPin",[["path",{d:"M20 10c0 6-8 12-8 12s-8-6-8-12a8 8 0 0 1 16 0Z",key:"2oe9fu"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]]);var n=t(3855),d=t(4659),o=t(8916),x=t(1664),m=t(9752),u=t(4256),p=t(4055),h=t(8029),j=t(3296),f=t(8069),b=t(4004);let g={receiver_name:"",receiver_phone:"",province:"",city:"",district:"",detail:"",postal_code:"",is_default:!1};function y(){let e=(0,l.useRouter)(),{isAuthenticated:s}=(0,h.t)(),{items:t,totalAmount:y,fetchCart:v,clearCart:N}=(0,j.x)(),[w,k]=(0,a.useState)([]),[_,C]=(0,a.useState)(null),[q,Z]=(0,a.useState)(!0),[P,z]=(0,a.useState)(!1),[A,M]=(0,a.useState)(!1),[S,R]=(0,a.useState)(g),[O,Y]=(0,a.useState)(!1),E=async()=>{try{let e=await f.Z.get("/auth/addresses/"),s=e.data.results||e.data;if(k(s),s.length>0){let e=s.find(e=>e.is_default);C(e?.id||s[0].id)}}catch(e){console.error("Failed to fetch addresses:",e)}},G=e=>{let{name:s,value:t,type:r,checked:a}=e.target;R(e=>({...e,[s]:"checkbox"===r?a:t}))},T=async()=>{if(!S.receiver_name||!S.receiver_phone||!S.province||!S.city||!S.district||!S.detail){b.A.error("请填写完整的收货信息");return}Y(!0);try{await f.Z.post("/auth/addresses/",S),b.A.success("地址添加成功"),M(!1),R(g),await E()}catch(e){b.A.error(e.response?.data?.detail||"添加地址失败")}finally{Y(!1)}},$=async()=>{if(!_){b.A.error("请选择收货地址");return}if(0===t.length){b.A.error("购物车是空的");return}z(!0);try{let s=t.map(e=>e.id);await f.Z.post("/orders/create/",{address_id:_,cart_item_ids:s}),await N(),b.A.success("订单创建成功"),e.push("/orders")}catch(e){b.A.error(e.response?.data?.detail||"创建订单失败")}finally{z(!1)}};return!s||q?r.jsx(p.h,{}):0===t.length?r.jsx("div",{className:"container mx-auto px-4 py-8",children:r.jsx(m.Zb,{children:(0,r.jsxs)(m.aY,{className:"p-12 text-center",children:[r.jsx(i.Z,{className:"w-16 h-16 mx-auto mb-4 text-gray-400"}),r.jsx("h2",{className:"text-xl font-semibold mb-2",children:"购物车是空的"}),r.jsx("p",{className:"text-gray-500 mb-4",children:"请先添加商品到购物车"}),r.jsx(x.z,{variant:"primary",onClick:()=>e.push("/products"),children:"去购物"})]})})}):(0,r.jsxs)("div",{className:"container mx-auto px-4 py-8",children:[r.jsx("h1",{className:"text-2xl font-bold mb-6",children:"确认订单"}),(0,r.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[(0,r.jsxs)("div",{className:"lg:col-span-2 space-y-6",children:[(0,r.jsxs)(m.Zb,{children:[(0,r.jsxs)(m.Ol,{className:"flex flex-row items-center justify-between",children:[(0,r.jsxs)(m.ll,{className:"flex items-center gap-2",children:[r.jsx(c,{className:"w-5 h-5"}),"收货地址"]}),(0,r.jsxs)(x.z,{variant:"default",size:"sm",onClick:()=>M(!0),children:[r.jsx(n.Z,{className:"w-4 h-4 mr-1"}),"添加地址"]})]}),r.jsx(m.aY,{children:0===w.length?(0,r.jsxs)("div",{className:"text-center py-4",children:[r.jsx("p",{className:"text-gray-500 mb-4",children:"暂无收货地址"}),r.jsx(x.z,{variant:"primary",onClick:()=>M(!0),children:"添加收货地址"})]}):r.jsx("div",{className:"space-y-3",children:w.map(e=>r.jsx("div",{className:`p-4 border rounded-lg cursor-pointer transition-colors ${_===e.id?"border-blue-500 bg-blue-50":"border-gray-200 hover:border-gray-300"}`,onClick:()=>C(e.id),children:(0,r.jsxs)("div",{className:"flex items-start gap-3",children:[r.jsx("div",{className:"mt-1",children:_===e.id&&r.jsx(d.Z,{className:"w-5 h-5 text-blue-500"})}),(0,r.jsxs)("div",{className:"flex-1",children:[(0,r.jsxs)("div",{className:"flex items-center gap-2 mb-1",children:[r.jsx("span",{className:"font-semibold",children:e.receiver_name}),r.jsx("span",{className:"text-gray-600",children:e.receiver_phone}),e.is_default&&r.jsx("span",{className:"px-2 py-0.5 bg-blue-100 text-blue-700 text-xs rounded",children:"默认"})]}),(0,r.jsxs)("p",{className:"text-gray-600",children:[e.province," ",e.city," ",e.district," ",e.detail]})]})]})},e.id))})})]}),(0,r.jsxs)(m.Zb,{children:[r.jsx(m.Ol,{children:(0,r.jsxs)(m.ll,{className:"flex items-center gap-2",children:[r.jsx(i.Z,{className:"w-5 h-5"}),"商品清单"]})}),r.jsx(m.aY,{children:r.jsx("div",{className:"space-y-4",children:t.map(e=>(0,r.jsxs)("div",{className:"flex gap-4",children:[r.jsx("img",{src:e.product.main_image||"/placeholder-product.jpg",alt:e.product.name,className:"w-20 h-20 object-cover rounded"}),(0,r.jsxs)("div",{className:"flex-1",children:[r.jsx("h3",{className:"font-semibold",children:e.product.name}),(0,r.jsxs)("p",{className:"text-sm text-gray-500",children:["\xa5",e.product.price," x ",e.quantity]})]}),r.jsx("div",{className:"text-right",children:(0,r.jsxs)("span",{className:"text-red-500 font-semibold",children:["\xa5",e.subtotal]})})]},e.id))})})]})]}),r.jsx("div",{className:"lg:col-span-1",children:(0,r.jsxs)(m.Zb,{className:"sticky top-4",children:[r.jsx(m.Ol,{children:(0,r.jsxs)(m.ll,{className:"flex items-center gap-2",children:[r.jsx(o.Z,{className:"w-5 h-5"}),"订单 summary"]})}),(0,r.jsxs)(m.aY,{children:[(0,r.jsxs)("div",{className:"space-y-3 text-sm",children:[(0,r.jsxs)("div",{className:"flex justify-between",children:[r.jsx("span",{className:"text-gray-600",children:"商品件数"}),(0,r.jsxs)("span",{children:[t.length," 件"]})]}),(0,r.jsxs)("div",{className:"flex justify-between",children:[r.jsx("span",{className:"text-gray-600",children:"商品总额"}),(0,r.jsxs)("span",{children:["\xa5",y]})]}),(0,r.jsxs)("div",{className:"flex justify-between",children:[r.jsx("span",{className:"text-gray-600",children:"运费"}),(0,r.jsxs)("span",{children:["\xa5",y>=199?0:10]})]}),(0,r.jsxs)("div",{className:"border-t pt-3 flex justify-between text-lg font-semibold",children:[r.jsx("span",{children:"实付金额"}),(0,r.jsxs)("span",{className:"text-red-500",children:["\xa5",y+(y>=199?0:10)]})]})]}),r.jsx(x.z,{variant:"primary",className:"w-full mt-6",size:"lg",onClick:$,disabled:!_||0===w.length||P,children:P?"提交中...":"提交订单"}),y<199&&(0,r.jsxs)("p",{className:"text-xs text-gray-500 mt-3 text-center",children:["再购 \xa5",199-y," 即可享受免费配送"]})]})]})})]}),r.jsx(u.u,{isOpen:A,onClose:()=>M(!1),title:"添加收货地址",size:"lg",children:(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,r.jsxs)("div",{children:[r.jsx("label",{className:"block text-sm font-medium mb-1",children:"收货人姓名"}),r.jsx("input",{type:"text",name:"receiver_name",value:S.receiver_name,onChange:G,className:"w-full border rounded px-3 py-2",placeholder:"请输入收货人姓名"})]}),(0,r.jsxs)("div",{children:[r.jsx("label",{className:"block text-sm font-medium mb-1",children:"联系电话"}),r.jsx("input",{type:"tel",name:"receiver_phone",value:S.receiver_phone,onChange:G,className:"w-full border rounded px-3 py-2",placeholder:"请输入联系电话"})]})]}),(0,r.jsxs)("div",{className:"grid grid-cols-3 gap-4",children:[(0,r.jsxs)("div",{children:[r.jsx("label",{className:"block text-sm font-medium mb-1",children:"省份"}),r.jsx("input",{type:"text",name:"province",value:S.province,onChange:G,className:"w-full border rounded px-3 py-2",placeholder:"例如：广东省"})]}),(0,r.jsxs)("div",{children:[r.jsx("label",{className:"block text-sm font-medium mb-1",children:"城市"}),r.jsx("input",{type:"text",name:"city",value:S.city,onChange:G,className:"w-full border rounded px-3 py-2",placeholder:"例如：深圳市"})]}),(0,r.jsxs)("div",{children:[r.jsx("label",{className:"block text-sm font-medium mb-1",children:"区/县"}),r.jsx("input",{type:"text",name:"district",value:S.district,onChange:G,className:"w-full border rounded px-3 py-2",placeholder:"例如：南山区"})]})]}),(0,r.jsxs)("div",{children:[r.jsx("label",{className:"block text-sm font-medium mb-1",children:"详细地址"}),r.jsx("input",{type:"text",name:"detail",value:S.detail,onChange:G,className:"w-full border rounded px-3 py-2",placeholder:"请输入详细地址"})]}),(0,r.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,r.jsxs)("div",{children:[r.jsx("label",{className:"block text-sm font-medium mb-1",children:"邮政编码（可选）"}),r.jsx("input",{type:"text",name:"postal_code",value:S.postal_code,onChange:G,className:"w-full border rounded px-3 py-2",placeholder:"请输入邮政编码"})]}),r.jsx("div",{className:"flex items-center",children:(0,r.jsxs)("label",{className:"flex items-center gap-2 cursor-pointer mt-6",children:[r.jsx("input",{type:"checkbox",name:"is_default",checked:S.is_default,onChange:G,className:"w-4 h-4"}),r.jsx("span",{className:"text-sm",children:"设为默认地址"})]})})]}),(0,r.jsxs)("div",{className:"flex justify-end gap-3 pt-4 border-t",children:[r.jsx(x.z,{variant:"default",onClick:()=>M(!1),children:"取消"}),r.jsx(x.z,{variant:"primary",onClick:T,disabled:O,children:O?"保存中...":"保存地址"})]})]})})]})}},9752:(e,s,t)=>{"use strict";t.d(s,{Ol:()=>c,Zb:()=>i,aY:()=>d,ll:()=>n});var r=t(326),a=t(7577),l=t(1867);let i=(0,a.forwardRef)(({className:e,...s},t)=>r.jsx("div",{ref:t,className:(0,l.cn)("rounded-lg border border-gray-200 bg-white shadow-sm",e),...s}));i.displayName="Card";let c=(0,a.forwardRef)(({className:e,...s},t)=>r.jsx("div",{ref:t,className:(0,l.cn)("flex flex-col space-y-1.5 p-6",e),...s}));c.displayName="CardHeader";let n=(0,a.forwardRef)(({className:e,...s},t)=>r.jsx("h3",{ref:t,className:(0,l.cn)("text-2xl font-semibold leading-none tracking-tight",e),...s}));n.displayName="CardTitle";let d=(0,a.forwardRef)(({className:e,...s},t)=>r.jsx("div",{ref:t,className:(0,l.cn)("p-6 pt-0",e),...s}));d.displayName="CardContent"},4055:(e,s,t)=>{"use strict";t.d(s,{h:()=>l});var r=t(326);function a({size:e="md"}){return r.jsx("div",{className:"flex items-center justify-center",children:r.jsx("div",{className:`border-4 border-gray-200 border-t-blue-600 rounded-full animate-spin ${{sm:"w-4 h-4",md:"w-8 h-8",lg:"w-12 h-12"}[e]}`})})}function l(){return r.jsx("div",{className:"flex items-center justify-center min-h-[50vh]",children:r.jsx(a,{size:"lg"})})}},4256:(e,s,t)=>{"use strict";t.d(s,{u:()=>n});var r=t(326),a=t(7577),l=t(4019),i=t(1867);let c={sm:"max-w-md",md:"max-w-lg",lg:"max-w-2xl",xl:"max-w-4xl"};function n({isOpen:e,onClose:s,title:t,children:n,size:d="md",showCloseButton:o=!0}){let x=(0,a.useRef)(null);return e?(0,r.jsxs)("div",{className:"fixed inset-0 z-50 overflow-y-auto",children:[r.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 transition-opacity",onClick:s}),r.jsx("div",{className:"flex min-h-full items-center justify-center p-4",children:(0,r.jsxs)("div",{ref:x,className:(0,i.cn)("relative bg-white rounded-lg shadow-xl w-full",c[d]),onClick:e=>e.stopPropagation(),children:[(t||o)&&(0,r.jsxs)("div",{className:"flex items-center justify-between p-6 border-b",children:[t&&r.jsx("h3",{className:"text-lg font-semibold",children:t}),o&&r.jsx("button",{onClick:s,className:"text-gray-400 hover:text-gray-600 transition-colors",children:r.jsx(l.Z,{className:"w-5 h-5"})})]}),r.jsx("div",{className:"p-6",children:n})]})})]}):null}},1324:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>r});let r=(0,t(8570).createProxy)(String.raw`/home/ubuntu/ecommerce/frontend/src/app/checkout/page.tsx#default`)}};var s=require("../../webpack-runtime.js");s.C(e);var t=e=>s(s.s=e),r=s.X(0,[120,252],()=>t(1274));module.exports=r})();