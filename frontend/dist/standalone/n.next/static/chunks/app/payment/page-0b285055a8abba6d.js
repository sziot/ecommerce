(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[790],{7803:function(e,t,r){Promise.resolve().then(r.bind(r,6804))},8226:function(e,t,r){"use strict";r.d(t,{Z:function(){return s}});let s=(0,r(9763).Z)("CreditCard",[["rect",{width:"20",height:"14",x:"2",y:"5",rx:"2",key:"ynyp8z"}],["line",{x1:"2",x2:"22",y1:"10",y2:"10",key:"1b3vmo"}]])},9376:function(e,t,r){"use strict";var s=r(5475);r.o(s,"useParams")&&r.d(t,{useParams:function(){return s.useParams}}),r.o(s,"useRouter")&&r.d(t,{useRouter:function(){return s.useRouter}}),r.o(s,"useSearchParams")&&r.d(t,{useSearchParams:function(){return s.useSearchParams}})},6804:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return p}});var s=r(7437),a=r(2265),n=r(9376),l=r(9763);let i=(0,l.Z)("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]]),o=(0,l.Z)("Loader2",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]]);var c=r(8226),d=r(2381),u=r(9820),m=r(4761),h=r(1217),f=r(1837),x=r(8249);function g(){let e=(0,n.useRouter)(),t=(0,n.useSearchParams)().get("order_id"),{isAuthenticated:r}=(0,h.t)(),[l,g]=(0,a.useState)(null),[p,v]=(0,a.useState)(!0),[b,y]=(0,a.useState)(!1),[j,N]=(0,a.useState)("alipay");(0,a.useEffect)(()=>{if(!r){e.push("/login");return}},[r,e]),(0,a.useEffect)(()=>{let s=async()=>{if(!t){e.push("/orders");return}try{let r=await f.Z.get("/orders/".concat(t,"/"));g(r.data),"pending"!==r.data.status&&(x.A.error("该订单不允许支付"),e.push("/orders"))}catch(t){console.error("Failed to fetch order:",t),x.A.error("获取订单失败"),e.push("/orders")}finally{v(!1)}};r&&t&&s()},[r,t,e]);let w=async()=>{if(l){y(!0);try{(await f.Z.post("/orders/".concat(l.id,"/pay/"),{payment_method:j})).data.success&&(x.A.success("支付成功"),e.push("/orders"))}catch(e){var t,r;x.A.error((null===(r=e.response)||void 0===r?void 0:null===(t=r.data)||void 0===t?void 0:t.error)||"支付失败")}finally{y(!1)}}};return r&&!p&&l?(0,s.jsxs)("div",{className:"container mx-auto px-4 py-8",children:[(0,s.jsxs)(d.z,{variant:"ghost",className:"mb-4",onClick:()=>e.push("/orders"),children:[(0,s.jsx)(i,{className:"w-4 h-4 mr-2"}),"返回订单列表"]}),(0,s.jsx)("div",{className:"max-w-2xl mx-auto",children:(0,s.jsxs)(u.Zb,{children:[(0,s.jsx)(u.Ol,{children:(0,s.jsx)(u.ll,{className:"text-xl",children:"确认支付"})}),(0,s.jsxs)(u.aY,{children:[(0,s.jsxs)("div",{className:"mb-6 p-4 bg-gray-50 rounded-lg",children:[(0,s.jsxs)("div",{className:"flex justify-between mb-2",children:[(0,s.jsx)("span",{className:"text-gray-600",children:"订单号"}),(0,s.jsx)("span",{className:"font-medium",children:l.order_no})]}),(0,s.jsxs)("div",{className:"flex justify-between mb-2",children:[(0,s.jsx)("span",{className:"text-gray-600",children:"商品总额"}),(0,s.jsxs)("span",{children:["\xa5",l.total_amount]})]}),(0,s.jsxs)("div",{className:"flex justify-between mb-2",children:[(0,s.jsx)("span",{className:"text-gray-600",children:"优惠"}),(0,s.jsxs)("span",{className:"text-red-500",children:["-\xa5",l.discount_amount]})]}),(0,s.jsxs)("div",{className:"flex justify-between mb-2",children:[(0,s.jsx)("span",{className:"text-gray-600",children:"运费"}),(0,s.jsxs)("span",{children:["\xa5",l.shipping_fee]})]}),(0,s.jsxs)("div",{className:"flex justify-between pt-2 border-t text-lg font-semibold",children:[(0,s.jsx)("span",{children:"实付金额"}),(0,s.jsxs)("span",{className:"text-red-500",children:["\xa5",l.actual_amount]})]})]}),(0,s.jsxs)("div",{className:"mb-6",children:[(0,s.jsx)("h3",{className:"font-semibold mb-3",children:"选择支付方式"}),(0,s.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,s.jsx)("div",{className:"p-4 border rounded-lg cursor-pointer transition-colors ".concat("alipay"===j?"border-blue-500 bg-blue-50":"border-gray-200 hover:border-gray-300"),onClick:()=>N("alipay"),children:(0,s.jsxs)("div",{className:"flex items-center gap-3",children:[(0,s.jsx)("div",{className:"w-10 h-10 bg-blue-500 rounded flex items-center justify-center",children:(0,s.jsx)("span",{className:"text-white font-bold text-lg",children:"A"})}),(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"font-medium",children:"支付宝"}),(0,s.jsx)("p",{className:"text-xs text-gray-500",children:"推荐使用"})]})]})}),(0,s.jsx)("div",{className:"p-4 border rounded-lg cursor-pointer transition-colors ".concat("wechat"===j?"border-green-500 bg-green-50":"border-gray-200 hover:border-gray-300"),onClick:()=>N("wechat"),children:(0,s.jsxs)("div",{className:"flex items-center gap-3",children:[(0,s.jsx)("div",{className:"w-10 h-10 bg-green-500 rounded flex items-center justify-center",children:(0,s.jsx)("span",{className:"text-white font-bold text-lg",children:"W"})}),(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"font-medium",children:"微信支付"}),(0,s.jsx)("p",{className:"text-xs text-gray-500",children:"便捷快速"})]})]})})]})]}),(0,s.jsx)("div",{className:"p-4 bg-yellow-50 border border-yellow-200 rounded-lg mb-6",children:(0,s.jsxs)("p",{className:"text-sm text-yellow-800",children:[(0,s.jsx)("strong",{children:"测试提示："}),'当前为模拟支付系统，点击"立即支付"按钮即可完成支付，无需真实付款。']})}),(0,s.jsx)(d.z,{variant:"primary",className:"w-full",size:"lg",onClick:w,disabled:b,children:b?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(o,{className:"w-5 h-5 mr-2 animate-spin"}),"支付中..."]}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(c.Z,{className:"w-5 h-5 mr-2"}),"立即支付 \xa5",l.actual_amount]})})]})]})})]}):(0,s.jsx)(m.h,{})}function p(){return(0,s.jsx)(a.Suspense,{fallback:(0,s.jsx)(m.h,{}),children:(0,s.jsx)(g,{})})}},2381:function(e,t,r){"use strict";r.d(t,{z:function(){return o}});var s=r(7437),a=r(2265),n=r(1001);let l={default:"bg-gray-200 text-gray-900 hover:bg-gray-300",primary:"bg-blue-600 text-white hover:bg-blue-700",ghost:"bg-transparent hover:bg-gray-100 text-gray-900",link:"bg-transparent text-blue-600 hover:underline p-0",danger:"bg-red-600 text-white hover:bg-red-700"},i={sm:"px-3 py-1.5 text-sm",md:"px-4 py-2 text-base",lg:"px-6 py-3 text-lg"},o=(0,a.forwardRef)((e,t)=>{let{className:r,variant:a="default",size:o="md",fullWidth:c=!1,disabled:d,...u}=e;return(0,s.jsx)("button",{ref:t,disabled:d,className:(0,n.cn)("inline-flex items-center justify-center rounded-md font-medium transition-colors","focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-blue-500","disabled:pointer-events-none disabled:opacity-50",l[a],i[o],c&&"w-full",r),...u})});o.displayName="Button"},9820:function(e,t,r){"use strict";r.d(t,{Ol:function(){return i},Zb:function(){return l},aY:function(){return c},ll:function(){return o}});var s=r(7437),a=r(2265),n=r(1001);let l=(0,a.forwardRef)((e,t)=>{let{className:r,...a}=e;return(0,s.jsx)("div",{ref:t,className:(0,n.cn)("rounded-lg border border-gray-200 bg-white shadow-sm",r),...a})});l.displayName="Card";let i=(0,a.forwardRef)((e,t)=>{let{className:r,...a}=e;return(0,s.jsx)("div",{ref:t,className:(0,n.cn)("flex flex-col space-y-1.5 p-6",r),...a})});i.displayName="CardHeader";let o=(0,a.forwardRef)((e,t)=>{let{className:r,...a}=e;return(0,s.jsx)("h3",{ref:t,className:(0,n.cn)("text-2xl font-semibold leading-none tracking-tight",r),...a})});o.displayName="CardTitle";let c=(0,a.forwardRef)((e,t)=>{let{className:r,...a}=e;return(0,s.jsx)("div",{ref:t,className:(0,n.cn)("p-6 pt-0",r),...a})});c.displayName="CardContent"},4761:function(e,t,r){"use strict";r.d(t,{h:function(){return n}});var s=r(7437);function a(e){let{size:t="md"}=e;return(0,s.jsx)("div",{className:"flex items-center justify-center",children:(0,s.jsx)("div",{className:"border-4 border-gray-200 border-t-blue-600 rounded-full animate-spin ".concat({sm:"w-4 h-4",md:"w-8 h-8",lg:"w-12 h-12"}[t])})})}function n(){return(0,s.jsx)("div",{className:"flex items-center justify-center min-h-[50vh]",children:(0,s.jsx)(a,{size:"lg"})})}},1837:function(e,t,r){"use strict";var s=r(3464),a=r(8249),n=r(8571);let l=s.Z.create({timeout:1e4,headers:{"Content-Type":"application/json"}});l.interceptors.request.use(e=>{let t="http://106.75.44.210:8000/api/v1";if(!t){let e=window.location.hostname;t="localhost"===e||"127.0.0.1"===e||e.includes("192.168.")||e.includes("10.")||e.includes("172.")?"http://localhost:8000/api/v1":n.env.NEXT_PUBLIC_PROD_API_URL||"/api/v1"}e.baseURL=t;{let t=localStorage.getItem("access_token");t&&(e.headers.Authorization="Bearer ".concat(t))}return e},e=>Promise.reject(e)),l.interceptors.response.use(e=>e,async e=>{var t,r,n;let i=e.config;if((null===(t=e.response)||void 0===t?void 0:t.status)===401&&!i._retry){i._retry=!0;try{let e=localStorage.getItem("refresh_token");if(e){let{access:t}=(await s.Z.post("".concat(i.baseURL,"/auth/refresh/"),{refresh:e})).data;return localStorage.setItem("access_token",t),i.headers.Authorization="Bearer ".concat(t),l(i)}}catch(e){return localStorage.removeItem("access_token"),localStorage.removeItem("refresh_token"),window.location.href="/login",Promise.reject(e)}}let o=(null===(n=e.response)||void 0===n?void 0:null===(r=n.data)||void 0===r?void 0:r.detail)||e.message||"请求失败";return a.A.error(o),Promise.reject(e)}),t.Z=l},1001:function(e,t,r){"use strict";r.d(t,{cn:function(){return n}});var s=r(1994),a=r(3335);function n(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return(0,a.m6)((0,s.W)(t))}},8249:function(e,t,r){"use strict";r.d(t,{A:function(){return n}});let s=null;function a(e,t){var r;let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=(s||((s=document.createElement("div")).id="toast-container",s.className="fixed top-4 right-4 z-[9999] flex flex-col gap-2 pointer-events-none",document.body.appendChild(s)),s),l=document.createElement("div");l.className="".concat({success:"bg-green-500",error:"bg-red-500",info:"bg-blue-500",warning:"bg-yellow-500"}[e]," text-white px-6 py-3 rounded-lg shadow-lg pointer-events-auto transform transition-all duration-300 translate-x-full opacity-0"),l.textContent=t,n.appendChild(l),requestAnimationFrame(()=>{l.classList.remove("translate-x-full","opacity-0")});let i=setTimeout(()=>{l.classList.add("translate-x-full","opacity-0"),setTimeout(()=>{var e;l.remove(),null===(e=a.onClose)||void 0===e||e.call(a),0===n.children.length&&(n.remove(),s=null)},300)},null!==(r=a.duration)&&void 0!==r?r:3e3);l.addEventListener("click",()=>{clearTimeout(i),l.classList.add("translate-x-full","opacity-0"),setTimeout(()=>{var e;l.remove(),null===(e=a.onClose)||void 0===e||e.call(a),0===n.children.length&&(n.remove(),s=null)},300)})}let n={success:(e,t)=>a("success",e,t),error:(e,t)=>a("error",e,t),info:(e,t)=>a("info",e,t),warning:(e,t)=>a("warning",e,t)}},1217:function(e,t,r){"use strict";r.d(t,{t:function(){return l}});var s=r(9625),a=r(6885),n=r(1837);let l=(0,s.Ue)()((0,a.tJ)((e,t)=>({user:null,accessToken:null,refreshToken:null,isAuthenticated:!1,setAuth:(t,r,s)=>{localStorage.setItem("access_token",r),localStorage.setItem("refresh_token",s),e({user:t,accessToken:r,refreshToken:s,isAuthenticated:!0})},login:async(e,r)=>{let{access:s,refresh:a,user:l}=(await n.Z.post("/auth/login/",{username:e,password:r})).data;t().setAuth(l,s,a)},register:async e=>{await n.Z.post("/auth/register/",e)},logout:()=>{localStorage.removeItem("access_token"),localStorage.removeItem("refresh_token"),e({user:null,accessToken:null,refreshToken:null,isAuthenticated:!1})},updateUser:t=>{e({user:t})},clearAuth:()=>{localStorage.removeItem("access_token"),localStorage.removeItem("refresh_token"),e({user:null,accessToken:null,refreshToken:null,isAuthenticated:!1})}}),{name:"auth-storage",partialize:e=>({accessToken:e.accessToken,refreshToken:e.refreshToken,user:e.user,isAuthenticated:e.isAuthenticated})}))}},function(e){e.O(0,[482,971,117,744],function(){return e(e.s=7803)}),_N_E=e.O()}]);