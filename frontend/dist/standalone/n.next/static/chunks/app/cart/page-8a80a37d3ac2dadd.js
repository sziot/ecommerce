(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[565],{5130:function(e,t,s){Promise.resolve().then(s.bind(s,4679))},1047:function(e,t,s){"use strict";s.d(t,{Z:function(){return a}});let a=(0,s(9763).Z)("Minus",[["path",{d:"M5 12h14",key:"1ays0h"}]])},4794:function(e,t,s){"use strict";s.d(t,{Z:function(){return a}});let a=(0,s(9763).Z)("Package",[["path",{d:"m7.5 4.27 9 5.15",key:"1c824w"}],["path",{d:"M21 8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16Z",key:"hh9hay"}],["path",{d:"m3.3 7 8.7 5 8.7-5",key:"g66t2b"}],["path",{d:"M12 22V12",key:"d0xqtd"}]])},9397:function(e,t,s){"use strict";s.d(t,{Z:function(){return a}});let a=(0,s(9763).Z)("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]])},6275:function(e,t,s){"use strict";s.d(t,{Z:function(){return a}});let a=(0,s(9763).Z)("ShoppingCart",[["circle",{cx:"8",cy:"21",r:"1",key:"jimo8o"}],["circle",{cx:"19",cy:"21",r:"1",key:"13723u"}],["path",{d:"M2.05 2.05h2l2.66 12.42a2 2 0 0 0 2 1.58h9.78a2 2 0 0 0 1.95-1.57l1.65-7.43H5.12",key:"9zh506"}]])},9376:function(e,t,s){"use strict";var a=s(5475);s.o(a,"useParams")&&s.d(t,{useParams:function(){return a.useParams}}),s.o(a,"useRouter")&&s.d(t,{useRouter:function(){return a.useRouter}}),s.o(a,"useSearchParams")&&s.d(t,{useSearchParams:function(){return a.useSearchParams}})},4679:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return y}});var a=s(7437),r=s(2265),n=s(9376),l=s(6275),c=s(1047),i=s(9397),o=s(9763);let d=(0,o.Z)("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]),u=(0,o.Z)("ArrowRight",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]]);var m=s(2381),h=s(9820),x=s(4761),p=s(8057),f=s(1217),g=s(7949),v=s(8249);function y(){let e=(0,n.useRouter)(),{isAuthenticated:t}=(0,f.t)(),{items:s,totalItems:o,totalAmount:y,fetchCart:j,updateCartItem:b,removeFromCart:N}=(0,g.x)(),[k,w]=(0,r.useState)(!0);(0,r.useEffect)(()=>{if(!t){e.push("/login");return}j().finally(()=>w(!1))},[t,e,j]);let C=async(e,t)=>{try{await b(e,t)}catch(e){v.A.error("更新失败")}},Z=async e=>{try{await N(e),v.A.success("已删除")}catch(e){v.A.error("删除失败")}};return!t||k?(0,a.jsx)(x.h,{}):(0,a.jsxs)("div",{className:"container mx-auto px-4 py-8",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2 mb-6",children:[(0,a.jsx)(l.Z,{className:"w-6 h-6"}),(0,a.jsx)("h1",{className:"text-2xl font-bold",children:"购物车"})]}),0===s.length?(0,a.jsx)(h.Zb,{children:(0,a.jsx)(h.aY,{className:"p-12",children:(0,a.jsx)(p.u,{title:"购物车是空的",description:"快去选购心仪的商品吧",action:(0,a.jsx)(m.z,{variant:"primary",onClick:()=>e.push("/products"),children:"去购物"})})})}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)(h.Zb,{children:[(0,a.jsxs)(h.aY,{className:"p-0",children:[(0,a.jsxs)("div",{className:"grid grid-cols-12 gap-4 p-4 border-b bg-gray-50 font-semibold text-sm",children:[(0,a.jsx)("div",{className:"col-span-6",children:"商品"}),(0,a.jsx)("div",{className:"col-span-2",children:"单价"}),(0,a.jsx)("div",{className:"col-span-2",children:"数量"}),(0,a.jsx)("div",{className:"col-span-1",children:"小计"}),(0,a.jsx)("div",{className:"col-span-1",children:"操作"})]}),s.map(e=>(0,a.jsxs)("div",{className:"grid grid-cols-12 gap-4 p-4 border-b items-center",children:[(0,a.jsx)("div",{className:"col-span-6",children:(0,a.jsxs)("div",{className:"flex gap-4",children:[(0,a.jsx)("img",{src:e.product.main_image||"/placeholder-product.jpg",alt:e.product.name,className:"w-20 h-20 object-cover rounded"}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"font-semibold",children:e.product.name}),(0,a.jsx)("p",{className:"text-sm text-gray-500",children:e.product.category_name})]})]})}),(0,a.jsx)("div",{className:"col-span-2",children:(0,a.jsxs)("span",{className:"text-red-500 font-semibold",children:["\xa5",e.product.price]})}),(0,a.jsx)("div",{className:"col-span-2",children:(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(m.z,{variant:"default",size:"sm",onClick:()=>C(e.id,Math.max(1,e.quantity-1)),disabled:e.quantity<=1,children:(0,a.jsx)(c.Z,{className:"w-3 h-3"})}),(0,a.jsx)("input",{type:"number",min:1,max:e.product.stock,value:e.quantity,onChange:t=>{let s=Math.max(1,Math.min(e.product.stock,parseInt(t.target.value)||1));C(e.id,s)},className:"w-16 text-center border rounded py-1"}),(0,a.jsx)(m.z,{variant:"default",size:"sm",onClick:()=>C(e.id,e.quantity+1),disabled:e.quantity>=e.product.stock,children:(0,a.jsx)(i.Z,{className:"w-3 h-3"})})]})}),(0,a.jsx)("div",{className:"col-span-1",children:(0,a.jsxs)("span",{className:"text-red-500 font-semibold text-lg",children:["\xa5",e.subtotal]})}),(0,a.jsx)("div",{className:"col-span-1",children:(0,a.jsx)(m.z,{variant:"ghost",size:"sm",onClick:()=>Z(e.id),className:"text-red-600 hover:text-red-700",children:(0,a.jsx)(d,{className:"w-4 h-4"})})})]},e.id))]}),(0,a.jsx)("div",{className:"p-4 border-t",children:(0,a.jsxs)("div",{className:"flex justify-between items-center flex-wrap gap-4",children:[(0,a.jsx)("div",{children:(0,a.jsxs)("span",{className:"text-gray-600",children:["已选择 ",(0,a.jsx)("span",{className:"text-blue-600 font-semibold",children:o})," 件商品"]})}),(0,a.jsxs)("div",{className:"flex items-center gap-6",children:[(0,a.jsx)("div",{children:(0,a.jsxs)("span",{className:"text-gray-600",children:["合计：",(0,a.jsxs)("span",{className:"text-red-500 font-semibold text-2xl",children:["\xa5",y]})]})}),(0,a.jsxs)(m.z,{variant:"primary",size:"lg",onClick:()=>e.push("/checkout"),children:[(0,a.jsx)(u,{className:"w-5 h-5 mr-2"}),"去结算"]})]})]})})]}),(0,a.jsx)(h.Zb,{className:"mt-4",children:(0,a.jsx)(h.aY,{className:"p-4",children:(0,a.jsxs)("div",{className:"flex flex-wrap gap-2",children:[(0,a.jsx)("span",{className:"inline-block px-3 py-1 bg-green-100 text-green-700 rounded text-sm",children:"满 \xa5199 包邮"}),(0,a.jsx)("span",{className:"inline-block px-3 py-1 bg-blue-100 text-blue-700 rounded text-sm",children:"7天无理由退换"}),(0,a.jsx)("span",{className:"inline-block px-3 py-1 bg-orange-100 text-orange-700 rounded text-sm",children:"正品保障"})]})})})]})]})}},2381:function(e,t,s){"use strict";s.d(t,{z:function(){return i}});var a=s(7437),r=s(2265),n=s(1001);let l={default:"bg-gray-200 text-gray-900 hover:bg-gray-300",primary:"bg-blue-600 text-white hover:bg-blue-700",ghost:"bg-transparent hover:bg-gray-100 text-gray-900",link:"bg-transparent text-blue-600 hover:underline p-0",danger:"bg-red-600 text-white hover:bg-red-700"},c={sm:"px-3 py-1.5 text-sm",md:"px-4 py-2 text-base",lg:"px-6 py-3 text-lg"},i=(0,r.forwardRef)((e,t)=>{let{className:s,variant:r="default",size:i="md",fullWidth:o=!1,disabled:d,...u}=e;return(0,a.jsx)("button",{ref:t,disabled:d,className:(0,n.cn)("inline-flex items-center justify-center rounded-md font-medium transition-colors","focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-blue-500","disabled:pointer-events-none disabled:opacity-50",l[r],c[i],o&&"w-full",s),...u})});i.displayName="Button"},9820:function(e,t,s){"use strict";s.d(t,{Ol:function(){return c},Zb:function(){return l},aY:function(){return o},ll:function(){return i}});var a=s(7437),r=s(2265),n=s(1001);let l=(0,r.forwardRef)((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)("div",{ref:t,className:(0,n.cn)("rounded-lg border border-gray-200 bg-white shadow-sm",s),...r})});l.displayName="Card";let c=(0,r.forwardRef)((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)("div",{ref:t,className:(0,n.cn)("flex flex-col space-y-1.5 p-6",s),...r})});c.displayName="CardHeader";let i=(0,r.forwardRef)((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)("h3",{ref:t,className:(0,n.cn)("text-2xl font-semibold leading-none tracking-tight",s),...r})});i.displayName="CardTitle";let o=(0,r.forwardRef)((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)("div",{ref:t,className:(0,n.cn)("p-6 pt-0",s),...r})});o.displayName="CardContent"},8057:function(e,t,s){"use strict";s.d(t,{u:function(){return n}});var a=s(7437),r=s(4794);function n(e){let{icon:t=(0,a.jsx)(r.Z,{className:"w-12 h-12"}),title:s="暂无数据",description:n,action:l}=e;return(0,a.jsxs)("div",{className:"flex flex-col items-center justify-center py-12 px-4",children:[(0,a.jsx)("div",{className:"text-gray-300 mb-4",children:t}),(0,a.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:s}),n&&(0,a.jsx)("p",{className:"text-sm text-gray-500 mb-4",children:n}),l]})}},4761:function(e,t,s){"use strict";s.d(t,{h:function(){return n}});var a=s(7437);function r(e){let{size:t="md"}=e;return(0,a.jsx)("div",{className:"flex items-center justify-center",children:(0,a.jsx)("div",{className:"border-4 border-gray-200 border-t-blue-600 rounded-full animate-spin ".concat({sm:"w-4 h-4",md:"w-8 h-8",lg:"w-12 h-12"}[t])})})}function n(){return(0,a.jsx)("div",{className:"flex items-center justify-center min-h-[50vh]",children:(0,a.jsx)(r,{size:"lg"})})}},1837:function(e,t,s){"use strict";var a=s(3464),r=s(8249),n=s(8571);let l=a.Z.create({timeout:1e4,headers:{"Content-Type":"application/json"}});l.interceptors.request.use(e=>{let t="http://106.75.44.210:8000/api/v1";if(!t){let e=window.location.hostname;t="localhost"===e||"127.0.0.1"===e||e.includes("192.168.")||e.includes("10.")||e.includes("172.")?"http://localhost:8000/api/v1":n.env.NEXT_PUBLIC_PROD_API_URL||"/api/v1"}e.baseURL=t;{let t=localStorage.getItem("access_token");t&&(e.headers.Authorization="Bearer ".concat(t))}return e},e=>Promise.reject(e)),l.interceptors.response.use(e=>e,async e=>{var t,s,n;let c=e.config;if((null===(t=e.response)||void 0===t?void 0:t.status)===401&&!c._retry){c._retry=!0;try{let e=localStorage.getItem("refresh_token");if(e){let{access:t}=(await a.Z.post("".concat(c.baseURL,"/auth/refresh/"),{refresh:e})).data;return localStorage.setItem("access_token",t),c.headers.Authorization="Bearer ".concat(t),l(c)}}catch(e){return localStorage.removeItem("access_token"),localStorage.removeItem("refresh_token"),window.location.href="/login",Promise.reject(e)}}let i=(null===(n=e.response)||void 0===n?void 0:null===(s=n.data)||void 0===s?void 0:s.detail)||e.message||"请求失败";return r.A.error(i),Promise.reject(e)}),t.Z=l},1001:function(e,t,s){"use strict";s.d(t,{cn:function(){return n}});var a=s(1994),r=s(3335);function n(){for(var e=arguments.length,t=Array(e),s=0;s<e;s++)t[s]=arguments[s];return(0,r.m6)((0,a.W)(t))}},8249:function(e,t,s){"use strict";s.d(t,{A:function(){return n}});let a=null;function r(e,t){var s;let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=(a||((a=document.createElement("div")).id="toast-container",a.className="fixed top-4 right-4 z-[9999] flex flex-col gap-2 pointer-events-none",document.body.appendChild(a)),a),l=document.createElement("div");l.className="".concat({success:"bg-green-500",error:"bg-red-500",info:"bg-blue-500",warning:"bg-yellow-500"}[e]," text-white px-6 py-3 rounded-lg shadow-lg pointer-events-auto transform transition-all duration-300 translate-x-full opacity-0"),l.textContent=t,n.appendChild(l),requestAnimationFrame(()=>{l.classList.remove("translate-x-full","opacity-0")});let c=setTimeout(()=>{l.classList.add("translate-x-full","opacity-0"),setTimeout(()=>{var e;l.remove(),null===(e=r.onClose)||void 0===e||e.call(r),0===n.children.length&&(n.remove(),a=null)},300)},null!==(s=r.duration)&&void 0!==s?s:3e3);l.addEventListener("click",()=>{clearTimeout(c),l.classList.add("translate-x-full","opacity-0"),setTimeout(()=>{var e;l.remove(),null===(e=r.onClose)||void 0===e||e.call(r),0===n.children.length&&(n.remove(),a=null)},300)})}let n={success:(e,t)=>r("success",e,t),error:(e,t)=>r("error",e,t),info:(e,t)=>r("info",e,t),warning:(e,t)=>r("warning",e,t)}},1217:function(e,t,s){"use strict";s.d(t,{t:function(){return l}});var a=s(9625),r=s(6885),n=s(1837);let l=(0,a.Ue)()((0,r.tJ)((e,t)=>({user:null,accessToken:null,refreshToken:null,isAuthenticated:!1,setAuth:(t,s,a)=>{localStorage.setItem("access_token",s),localStorage.setItem("refresh_token",a),e({user:t,accessToken:s,refreshToken:a,isAuthenticated:!0})},login:async(e,s)=>{let{access:a,refresh:r,user:l}=(await n.Z.post("/auth/login/",{username:e,password:s})).data;t().setAuth(l,a,r)},register:async e=>{await n.Z.post("/auth/register/",e)},logout:()=>{localStorage.removeItem("access_token"),localStorage.removeItem("refresh_token"),e({user:null,accessToken:null,refreshToken:null,isAuthenticated:!1})},updateUser:t=>{e({user:t})},clearAuth:()=>{localStorage.removeItem("access_token"),localStorage.removeItem("refresh_token"),e({user:null,accessToken:null,refreshToken:null,isAuthenticated:!1})}}),{name:"auth-storage",partialize:e=>({accessToken:e.accessToken,refreshToken:e.refreshToken,user:e.user,isAuthenticated:e.isAuthenticated})}))},7949:function(e,t,s){"use strict";s.d(t,{x:function(){return l}});var a=s(9625),r=s(6885),n=s(1837);let l=(0,a.Ue)()((0,r.tJ)((e,t)=>({items:[],totalItems:0,totalAmount:0,isLoading:!1,fetchCart:async()=>{e({isLoading:!0});try{let{items:t,total_items:s,total_amount:a}=(await n.Z.get("/cart/")).data;e({items:t,totalItems:s,totalAmount:a,isLoading:!1})}catch(t){throw e({isLoading:!1}),t}},setCart:(t,s,a)=>{e({items:t,totalItems:s,totalAmount:a})},addToCart:async function(e){let s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;await n.Z.post("/cart/items/",{product_id:e,quantity:s}),t().fetchCart()},updateCartItem:async(e,s)=>{await n.Z.patch("/cart/items/".concat(e,"/"),{quantity:s}),t().fetchCart()},removeFromCart:async e=>{await n.Z.delete("/cart/items/".concat(e,"/")),t().fetchCart()},clearCart:async()=>{await n.Z.delete("/cart/clear/"),e({items:[],totalItems:0,totalAmount:0})}}),{name:"cart-storage"}))}},function(e){e.O(0,[482,971,117,744],function(){return e(e.s=5130)}),_N_E=e.O()}]);